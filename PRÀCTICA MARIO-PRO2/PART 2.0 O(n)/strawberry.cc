#include "strawberry.hh"
#include "utils.hh"
#include <cmath>

using namespace std;
using namespace pro2;

const int _ = -1;
const int w = -1;
const int g = -1;
const int w2 = -1;
const int g2 = -1;
const int g3 = -1;

const int Width  = 8;  // amplada de l’sprite
const int Height = 11;  // alçada de l’sprite

const int amplada = 10;
const float f_angular = 0.05;

const vector<vector<vector<int>>> Strawberry::strawberry_sprites_ = {
	{ // 'normal00', 18x16px
	{-1, -1, -1, -1, 0x006abe30, -1, -1, -1}, 
	{-1, -1, 0x006abe30, -1, 0x0037946e, 0x006abe30, -1, -1}, 
	{-1, 0x006abe30, 0x00491675, 0x006abe30, 0x006abe30, 0x00491675, -1, -1}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x008a0f36, 0x008a0f36}, 
	{0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42}, 
	{0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x008a0f36}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal01', 18x16px
	{-1, -1, -1, 0x006abe30, -1, 0x006abe30, -1, -1}, 
	{-1, -1, 0x006abe30, 0x006abe30, 0x006abe30, 0x0037946e, -1, -1}, 
	{-1, -1, 0x00491675, 0x0037946e, 0x006abe30, 0x00491675, -1, -1}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x0037946e, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36}, 
	{0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal02', 18x16px
	{-1, -1, 0x006abe30, -1, 0x006abe30, 0x006abe30, -1, -1}, 
	{-1, 0x006abe30, 0x006abe30, -1, 0x0037946e, 0x006abe30, -1, -1}, 
	{-1, -1, 0x00491675, 0x006abe30, 0x006abe30, 0x0037946e, 0x006abe30, -1}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a}, 
	{0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a}, 
	{0x00ff5f42, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00ff5f42}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal03', 18x16px
	{-1, -1, -1, -1, 0x006abe30, 0x006abe30, -1, -1}, 
	{-1, 0x006abe30, 0x006abe30, -1, 0x0037946e, 0x0037946e, 0x006abe30, -1}, 
	{-1, -1, 0x00491675, 0x006abe30, 0x006abe30, 0x00491675, -1, -1}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36}, 
	{0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a}, 
	{0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal04', 18x16px
	{-1, -1, -1, -1, 0x006abe30, 0x006abe30, -1, -1}, 
	{-1, 0x006abe30, 0x006abe30, -1, 0x0037946e, 0x0037946e, 0x006abe30, -1}, 
	{0x0037946e, -1, 0x00491675, 0x006abe30, 0x006abe30, 0x00491675, -1, 0x0037946e}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00ff5f42, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36}, 
	{0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42}, 
	{0x008a0f36, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36}, 
	{0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal05', 18x16px
	{-1, -1, -1, 0x006abe30, 0x006abe30, 0x006abe30, -1, -1}, 
	{0x006abe30, 0x006abe30, 0x006abe30, -1, 0x0037946e, 0x0037946e, 0x006abe30, 0x006abe30}, 
	{0x0037946e, -1, 0x00491675, 0x006abe30, 0x006abe30, 0x00491675, -1, 0x0037946e}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x008a0f36}, 
	{0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
	{ // 'normal06', 18x16px
	{-1, -1, -1, -1, 0x006abe30, 0x006abe30, -1, -1}, 
	{-1, 0x006abe30, 0x006abe30, -1, 0x0037946e, 0x0037946e, 0x006abe30, -1}, 
	{0x0037946e, -1, 0x00491675, 0x006abe30, 0x006abe30, 0x00491675, -1, 0x0037946e}, 
	{-1, 0x00491675, 0x008a0f36, 0x00491675, 0x00491675, 0x008a0f36, 0x00491675, -1}, 
	{0x008a0f36, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36}, 
	{0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x00de2a2a, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a}, 
	{0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00ff5f42, 0x00de2a2a, 0x008a0f36, 0x00de2a2a}, 
	{0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x00de2a2a, 0x008a0f36, 0x00de2a2a, 0x008a0f36, 0x00de2a2a}, 
	{-1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1}, 
	{-1, -1, 0x00de2a2a, 0x008a0f36, 0x008a0f36, 0x00de2a2a, -1, -1}, 
	{-1, -1, -1, 0x00de2a2a, 0x00de2a2a, -1, -1, -1}, 
	},
};

void Strawberry::paint(pro2::Window& window) const {
    if (collected_) return;
	
	const Pt top_left = {pos_.x - Width/2, pos_.y - Height - 1};
	vector<vector<int>> actual_sprite = strawberry_sprites_[(window.frame_count()%(strawberry_sprites_.size()*4))/4];
    paint_sprite(window, top_left, actual_sprite, false);
}

void Strawberry::update(pro2::Window& window)
{
	if (collected_) return;
	// Li resto amplada pq la base_pos sigui la posició d'abaix de tot i no la del mig
	pos_.y = base_pos_.y - amplada + amplada*sin(f_angular*window.frame_count());
}

// Constructora
Strawberry::Strawberry(Pt pos) {
    pos_ = pos;
	base_pos_ = pos;
}


Rect Strawberry::get_rect() const {
    return {pos_.x-Width/2, pos_.y-Height, pos_.x+Width/2, pos_.y};
}

bool Strawberry::is_collected() const {
	return collected_;
}

void Strawberry::collect() {
	collected_ = true;
}